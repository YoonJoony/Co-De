<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main</title>
    <link rel="stylesheet" href="/css/main_page2.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com"> <!--  <p> í°íŠ¸ ì ìš© -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> <!--  <p> í°íŠ¸ ì ìš© -->
    <link href="https://fonts.googleapis.com/css2?family=Play:wght@700&display=swap" rel="stylesheet">
    <!--  <p> í°íŠ¸ ì ìš© -->
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Play:wght@700&display=swap"
          rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Play:wght@700&display=swap"
          rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Play:wght@700&display=swap"
          rel="stylesheet">

    <!-- ë‹¤ìŒ ì£¼ì†Œ ì°¾ê¸° API -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
            crossorigin="anonymous"></script>
</head>

<body>
<div class="main">
    <div class="topper">
        <!-- ë¡œê·¸ì¸ ë¶€ë¶„ -->
        <div class="login">
            <a href="#" class="v-bar" style="color: #8E8E8E">ë„ì›€ë§</a>
            <a href="#" class="v-bar" style="color: #8E8E8E">ì´ë²¤íŠ¸</a>
            <a href="/logout" class="logout" style="color: #8E8E8E">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
    </div>
    <!-- í—¤ë” ë¶€ë¶„ -->
    <div class="header">
        <!-- CO-ORDER ì œëª© ë¶€ë¶„ -->
        <div class="width-container">
            <div class="logo-img">
                <!--            <a href="ë©”ì¸í™”ë©´ ë§í¬" style="color: #7CAB75">CO-OR</a>-->
                <img class="logo" src="images/COOR2.png">
            </div>
            <div id="header-bell" class="header-bell" style="cursor:pointer;">
                    <span class="bell">
                        <img src="images/bell.png" style="width : 25px; height : 25px;" alt="">
                    </span>
            </div>
            <div id="header-profile" class="header-profile">
                <a class="header-user">
                        <span class="user-picture">
                            <img src="images/profile.png" height="50px" width="50px">
                        </span>
                    <span class="user-name" th:text="${nickname}">
                        </span>
                    <span class="header-arrow">
                            <img src="https://buts.co.kr/thema/Buts/colorset/Basic/img/mymenu-arrow.png" alt="">
                        </span>
                </a>
                <div id="layer-header-profile" class="layer-header-profile" style="display : none;">
                    <div class="block block-name">
                        <div class="profile-name" th:text="${nickname}">
                        </div>
                        <div class="buttons">
                            <a href="#">íŒŒí‹°ê´€ë¦¬</a>
                        </div>
                    </div>
                    <!--                    <div class="header-profile-direct">-->
                    <!--                        <dl class="header-member-direct__information">-->
                    <!--                            <div class="profile-nickname" th:text="${nickname}"></div>-->
                    <!--                            <input type="button" id="profile_btn_btn" onclick="myPage()" value="ë§ˆì´í˜ì´ì§€"></input>-->
                    <!--                            <dd>ã…‡ã…‡</dd>-->
                    <!--                            <dd>ã…‡ã…‡</dd>-->
                    <!--                        </dl>-->
                    <!--                    </div>-->
                </div>
            </div>
        </div>
        <!-- ì£¼ì†Œ ì…ë ¥ ë¶€ë¶„ -->
        <div class="search-container">
            <div class="search">
                <button id="loc_btn" type="button" name="loc_btn" onclick="getCurrentPosition()">
                    <img class="gps" src="images/search.png">
                </button>
                <input id="search_input" type="text" name="address" required placeholder="ëª¨ì§‘ê¸€ ê²€ìƒ‰ì„ ì‹œì‘í•´ë³´ì„¸ìš”!">
                <div class="tag-container">
                    <div class="tag real-time-text">
                        <p class="search-tag-text">ì‹¤ì‹œê°„ ê²€ìƒ‰ íƒœê·¸</p>
                    </div>
                    <div class="tag real-time">
                        #ì¹˜í‚¨ &nbsp;&nbsp;#í¬ì¼€ &nbsp;&nbsp;#ë§ˆë¼íƒ•
                    </div>
                </div>
            </div>
            <ul>
                <li class="menu-li">
                    <a class="menu-a">ì „ì²´ ê¸€</a>
                </li>
                <li class="menu-li">
                    <a class="menu-a">ì¹´í…Œê³ ë¦¬</a>
                </li>
                <li class="menu-li">
                    <a class="menu-a">ë‚´ ì±„íŒ…</a>
                </li>
            </ul>

        </div>
        <!-- í”„ë¡œí•„ -->

    </div>

    <!-- ê²Œì‹œíŒ í‹€ DBì— ìˆëŠ” ëª¨ì§‘ê¸€ ë°ì´í„°ë¥¼ ì¡°íšŒí•´ì„œ ëª¨ì§‘ê¸€ ì¶œë ¥-->
    <div class="ad">
        <a href="#">
            <img img="" src="https://buts.co.kr/thema/Buts/colorset/Basic/img/guide_main_banner.png" alt="" title=""
                 class="ad-img">
        </a>
    </div>
    <div class="search-list">
        <input id="search_btn" type="button" value="íƒœê·¸ ë“¤ì–´ê°€ì•¼í•¨."></input>
    </div>
    <div class="board-list">
        <th:block th:each="post : ${postList}">
            <div class="board" style="position: absolute; left: 0%; top: 0px;">
                <img class="board-img" src="images\chicken.png">
                <div class="boards">
                    <div class="board-header">
                        <div class="board-time" th:text="${#temporals.format(post.create_Date, 'HH:mm')}"></div>
                        <img class="board-link" src="images\link.png" href="#enterRoomModal" data-bs-toggle="modal"
                             data-target="#enterRoomModal" th:data-id="${post.id}" th:data-nickname="${nickname}"
                             onclick="backdropDelete()">
                    </div>
                    <div class="board-nickname" th:text="${post.nickname}"></div>
                    <div class="board-title" th:text="${post.title}"><a href="#"></a></div>
                    <div class="board-button" href="#enterRoomModal" data-bs-toggle="modal"
                         data-target="#enterRoomModal" th:data-id="${post.id}" th:data-nickname="${nickname}"
                         onclick="backdropDelete()"></a>
                        <button class="join">Go GO~</button>
                    </div>
                    <div class="board-categories" th:text="${post.categories}"></div>
                    <div class="board-peoples" th:text="${post.usercount} + '/' +${post.peoples}"></div>
                    <!--            <div class="food" th:text="${post.categories}"></div>-->
                </div>
            </div>
        </th:block>

    </div>
</div>



<!-- ëª¨ì§‘ê¸€ ìƒì„± -->
<div class="make-content">
    <button type="button" class="createOpen" id="createOpen">ëª¨ì§‘ê¸€ ìƒì„± ğŸ“£</button>
</div>

<section class="Register">
    <div class="modal" id="modal">
        <div class="popup" id="popup">
            <form action="/mozip" method="post">
                <div class="m_head">
                    <div class="modal_title">
                        <h1></h1>
                    </div>
                </div>
                <div class="m_body">
                    <div class="input-area">
                        <div class="body-titlebox">
                            <h2 class="mozip-h2">ë°°ê³ í”ˆ ì‚¬ëŒ ëª¨ì—¬ë¼!</h2>
                        </div>
                        <div class="body-contentbox">
                            <div class="input-area">
                                <input type="text" name="title" id="title" autocomplete="off" required>
                                <label for="title">ì œëª©</label>
                            </div>

                            <div class="input-area">
                                <input type="number" name="distance_limit" id="distance_limit" autocomplete="off"
                                       required max="500">
                                <label for="distance_limit">ê¸€ ë…¸ì¶œ ê±°ë¦¬ ì œí•œ</label>
                            </div>
                            <div class="input-area">
                                <button class="add_store" id="add_store" type="button">ê°€ê²Œì¶”ê°€</button>
                            </div>

                            <div class="input-area">
                                <div class="sel">
                                    <select id="category" required>
                                        <option value="" disabled>ì¹´í…Œê³ ë¦¬</option>
                                        <option value="ì¹˜í‚¨">ì¹˜í‚¨</option>
                                        <option value="í”¼ì/ì–‘ì‹">í”¼ì/ì–‘ì‹</option>
                                        <option value="ì¤‘ì‹">ì¤‘ì‹</option>
                                        <option value="í•œì‹">í•œì‹</option>
                                        <option value="ì¼ì‹/ëˆê¹ŒìŠ¤">ì¼ì‹/ëˆê¹ŒìŠ¤</option>
                                        <option value="ì¡±ë°œ/ë³´ìŒˆ">ì¡±ë°œ/ë³´ìŒˆ</option>
                                        <option value="ê³ ê¸°">ê³ ê¸°</option>
                                        <option value="ë¶„ì‹">ë¶„ì‹</option>
                                        <option value="ì¹´í˜/ë””ì €íŠ¸">ì¹´í˜/ë””ì €íŠ¸</option>
                                        <option value="ì•„ì‹œì•ˆ">ì•„ì‹œì•ˆ</option>
                                        <option value="ìƒŒë“œìœ„ì¹˜">ìƒŒë“œìœ„ì¹˜</option>
                                        <option value="ì…€ëŸ¬ë“œ">ì…€ëŸ¬ë“œ</option>
                                        <option value="ë„ì‹œë½/ì£½">ë„ì‹œë½/ì£½</option>
                                    </select>
                                </div>
                            </div>

                            <div class="input-area">
                                <div class="sel people">
                                    <select id="people" required>
                                        <option value="" disabled>ì¸ì› ìˆ˜</option>
                                        <option value="2">2ëª…</option>
                                        <option value="3">3ëª…</option>
                                        <option value="4">4ëª…</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <div class="m_footer">
                    <button class="pop-btn create" id="create" type="submit">ê¸€ ìƒì„±</button>
                    <span class="pop-btn close" id="close">ì°½ ë‹«ê¸°</span>
                </div>
            </form>
        </div>
    </div>
</section>

<!-- ëª¨ì§‘ê¸€ í´ë¦­ì‹œ ëª¨ë‹¬ì°½ ë³´ì—¬ì¤Œ -->
<div class="modal fade" id="enterRoomModal" tabindex="-1" aria-labelledby="enterRoomModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <img class="join-img" src="images/join.png">
                <p class="join-icon">ğŸ’¡</p>
                <p class="join-p">ì…ì¥ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            </div>
            <div class="modal-footer">
                <input class="btn btn-access" id="join_btn" type="button" value="ì…ì¥" data-bs-dismiss="modal"
                       onclick="enterRoom()">
                <input class="btn btn-back" id="modal_close_btn" type="button" data-bs-dismiss="modal" value="ì·¨ì†Œ">
            </div>
        </div>
    </div>
</div>
<!-- ê°€ê²Œì„ íƒ ë²„íŠ¼ í´ë¦­ì‹œ ê°€ê²Œ ë¦¬ìŠ¤íŠ¸ ëª¨ë‹¬ì°½ ë³´ì—¬ì¤Œ -->
<div class="storeModal">
    <div class="storeModal_content">
        <div class="storeModal_header">
            <input id="search_store" type="text">
            </input>
            <button id="search_store_btn" type="button">ê²€ìƒ‰
            </button>
        </div>
        <!-- ---------------------------------------- -->
        <div class="storeModal_body">

        </div>
        <!-- -------------------------------------------- -->
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.1.4/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
<script th:inline="javascript">


        function DaumPostcode() {
            new daum.Postcode({
                oncomplete: function (data) {
                    document.getElementById('address_input').value = data.address;
                }
            }).open();
        }

        document.getElementById("create").addEventListener("click", function () {
            var selectedValue1 = document.getElementById("category").value; // select optionì—ì„œ ì„ íƒëœ ê°’ ê°€ì ¸ì˜¤ê¸°
            var selectedValue2 = document.getElementById("people").value; // select optionì—ì„œ ì„ íƒëœ ê°’ ê°€ì ¸ì˜¤ê¸°
            $.ajax({
                type: "POST", // ì „ì†¡ ë°©ì‹
                url: "/mozipCreate", // ì»¨íŠ¸ë¡¤ëŸ¬ URL
                data: {
                    selectedValue1: selectedValue1,
                    selectedValue2: selectedValue2
                }, // ì „ë‹¬í•  ë°ì´í„°
                success: function (result) {
                    $("#changeInput").val('ì„±ê³µ');
                },
                error: function (xhr, status, error) {
                    $("#changeInput").val('ì‹¤íŒ¨');
                }
            });
        });

        let id;



        function backdropDelete() {
            // $('.modal-backdrop').remove();
        }

        var myModal = new bootstrap.Modal(document.getElementById('enterRoomModal'), {
            backdropDelete: true
        });
        $(function () {

            $("#enterRoomModal").on("show.bs.modal", function (event) {
                id = $(event.relatedTarget).data('id');
                nickname = $(event.relatedTarget).data('nickname');
            });

        })


        function chkRoomUserCnt(id, nickname) {
            let chk;

            $.ajax({
                type: "GET",
                url: "/mozip/chat/chkRoomUserCnt",
                data: {
                    id: id,
                    nickname: nickname
                },
                async: false,
                success: function (result) {
                    if (!result) {
                        alert("ì±„íƒ•ë°©ì´ ê½‰ ì°¼ë‹¤!");
                    }
                    chk = result;
                },
                error: function () {
                    alert("ì‹¤íŒ¨!");
                }
            })
            return chk;
        }



        function enterRoom() {
            if (chkRoomUserCnt(id, nickname)) {
                location.href = "/mozip/chat/room?id=" + id;
            }
        }
    </script>
<script src="/js/main_page.js"></script>
<script src="/js/addStore.js"></script>

</body>

</html>